# 🎣 Ultimate Fishing VR (Web Serial Edition)

以下AIによるわかりやすい解説です。

Raspberry Pi Picoとブラウザを **Web Serial API** で接続して遊ぶ、体感型バーチャル釣りゲームです。
自作のロッド型コントローラーを振り、画面上の魚と真剣勝負を繰り広げます。

---

## ✨ 主な機能

- **体感ジャイロ操作**: 加速度センサー（ADXL345）により、竿の跳ね上げ動作をリアルタイムに検知。
- **2画面連携（マルチモニター）**: 
  - **PC画面**: 美しい（？）魚たちの動きと水中世界。
  - **Pico画面**: コックピット風ソナー。一番近い魚の方向を指す「アクティブ・ナビ矢印」と「距離計」を搭載。
- **タクティカル・サウンド**: 魚との距離に応じてブザーのテンポが変化。目を使わずに距離を察知可能。
- **本格フィッシングAI**: 魚種ごとの性格（臆病、攻撃的、レア度）や、着水音によるパニック反応を再現。
- **アーケードシステム**: 3分間の制限時間、コンボボーナス、スコアに応じたS〜Dランク判定。（実装予定でした）

---

## 🛠 ハードウェア構成

### 使用パーツ
- **マイコン**: Raspberry Pi Pico / Pico W
- **ディスプレイ**: 128x64 OLED (SSD1306 / I2C接続)
- **センサー**: ADXL345 (3軸加速度センサー / I2C接続)
- **入力**: 2軸アナログジョイスティック、プッシュボタン×2
- **出力**: 圧電ブザー

### 配線図 (ピンアサイン例)
| デバイス | ピン (Pico) | 役割 |
|:---:|:---:|:---:|
| OLED | GP16(SDA), GP17(SCL) | I2C0: ソナー表示 |
| ADXL345 | GP18(SDA), GP19(SCL) | I2C1: 角度検知 |
| Joystick | ADC0, ADC1 | 移動操作 |
| Button 1 | GP21 | キャスト/決定 |
| Button 2 | GP20 | ポーズ/中断 |
| Buzzer | GP15 | 近接アラート音 |

---

## 🎮 遊び方

1. **接続**: ブラウザでアプリを起動し、PicoをUSB接続して「START」をクリック。
2. **探索 (AIMING)**: 竿を上げた状態でジョイスティックを操作。Picoの矢印に従って魚の頭上へウキを移動。
3. **待機 (SINKING)**: 竿を下ろしてウキを沈めます。魚が近づくとPicoのブザーが激しく鳴ります。
4. **ファイト (BITE)**: 「!!! PULL UP !!!」の合図で竿を素早く跳ね上げろ！
5. **リザルト**: 3分終了後、ハイスコアとランクが表示されます。<-実装できてましたがデータが消えたので今はありません

---

## 📁 ソフトウェア詳細

### 💻 Web App (React + TypeScript)
- **Web Serial API**: 115200bpsでの双方向シリアル通信。
- **Game Engine**: `requestAnimationFrame` ベースの独自物理・AIエンジン。
- **Responsive**: 画面サイズに合わせて魚の最大出現数を自動調整。

### 🐍 Pico (MicroPython)
- **マルチタスク**: センサー読み取りと画面描画の並列処理。
- **最適化**: 描画処理をフレームスキップし、ジャイロの反応速度を最優先。
- **安全装置**: 通信切断時（ブラウザを閉じた際など）にブザーを自動停止するウォッチドッグ機能。

---

## 🚀 セットアップ

1. Picoに `main.py` を書き込み、必要なライブラリ（`ssd1306.py`, `adxl345.py`）を配置。
2. Web側で `npm install` して `npm run dev`。
3. コントローラーを縦に持ち、思い切り釣りを楽しんでください！

---

## 実行環境
私が開発時に使用してた実行環境を載せます。それ以外の環境は私も知らないので頑張って動かしてください！
-**OS**: Arch linux x86_64。多分ほかのOSでも行けるはず。
-**IDE**: VScode。MicroPicoの拡張を追加して書き込みしました。参考程度に…https://micropython.org/download/RPI_PICO/
-**ブラウザ**: Chronium。Serial APIが使えるブラウザならおそらくなんでも行けるはず…そもそもSerial API自体が広く普及していないので使えるブラウザは限られると思う。（Edgeは行けるみたい）参考程度に…https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API
-**node.js**:v25.2.1。Viteが動かせれば。
-**Package Manager**: npm v11.6.4。お好みのものを…

> **Developer Note**: 
> 途中ポーズ機能や3分間でスコアを競うモードまでこぎつけたものの原因不明の通信ができない現象により、安定してた作りかけを公開してます。
> 時間がなかったのでデバッグ用の表記やゲーム終了後もブザーが鳴り続けるなど問題は多々ありますが（本当は直ってた）お楽しみいただければ幸いです。
> スタート押してもうまく行かない場合はほとんどSerial APIが関係してます。使用ブラウザの見直し、リロードなど色々試してください。
